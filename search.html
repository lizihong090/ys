<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>查詢電話號碼</title>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";
  import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAq8_DC6kLl2bmqNKvv1q7ghZr0-7Ej4_k",
    authDomain: "yesh-87d8e.firebaseapp.com",
    projectId: "yesh-87d8e",
    storageBucket: "yesh-87d8e.firebasestorage.app",
    messagingSenderId: "969667016769",
    appId: "1:969667016769:web:6715fb42ed5daaa5b66ec0",
    measurementId: "G-ETRBPCH2XN"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  let currentUser = null;

  onAuthStateChanged(auth, user => {
    if (user) {
      currentUser = user;
    } else {
      alert("請先登入！");
      window.location.href = "login.html";
    }
  });

  window.searchPhoneNumber = async () => {
    const phoneInput = document.getElementById("phoneInput").value.trim();
    const phoneRegex = /^09\d{8}$/;

    if (!phoneRegex.test(phoneInput)) {
      alert("電話號碼格式錯誤，請輸入09開頭共10碼的號碼");
      return;
    }

    try {
      const userDoc = doc(db, "users", currentUser.uid);
      const docSnap = await getDoc(userDoc);
      if (docSnap.exists()) {
        const data = docSnap.data();
        if (data.phones && data.phones.some(p => p.number === phoneInput)) {
          alert(`電話號碼 ${phoneInput} 已存在`);
        } else {
          alert(`電話號碼 ${phoneInput} 不存在`);
        }
      } else {
        alert("尚無任何電話號碼資料");
      }
    } catch (error) {
      alert("查詢失敗：" + error.message);
    }
  };
</script>
</head>
<body>
  <h1>查詢電話號碼</h1>
  <input id="phoneInput" type="text" placeholder="輸入電話號碼 09xxxxxxxx" maxlength="10" />
  <button onclick="searchPhoneNumber()">查詢</button>
  <br><br>
  <button onclick="window.location.href='member.html'">回會員頁面</button>
</body>
</html>
